[gd_scene load_steps=29 format=3 uid="uid://cy5lmq1djweto"]

[ext_resource type="Script" uid="uid://2ctr74rdos6v" path="res://Scripts/Enemies/StateMachine/EnemyStateMachine.cs" id="1_3u8xu"]
[ext_resource type="Script" uid="uid://b0k1rr2yuf22n" path="res://Scripts/Utilities/EnemyEntityAccessor.cs" id="1_eyhau"]
[ext_resource type="AnimationLibrary" uid="uid://beh47qlnu58iu" path="res://Animations/Humanoid/TEMP_EnemyAnimLibrary.res" id="2_bhjmh"]
[ext_resource type="PackedScene" uid="uid://ws41u2pj3csp" path="res://GameObjects/AbilityBase.tscn" id="2_uivum"]
[ext_resource type="PackedScene" uid="uid://bbf6ttwtueode" path="res://Art/_Enemies_TEMP/SM_Prop_SwordOrnate_01.fbx" id="2_vq338"]
[ext_resource type="PackedScene" uid="uid://bvdaqn11tg0jw" path="res://Art/NPCRig.fbx" id="2_w1h0a"]
[ext_resource type="Script" uid="uid://ct0h6lq4lcxnx" path="res://Scripts/Enemies/StateMachine/EnemyIdleState.cs" id="3_epsjv"]
[ext_resource type="Script" uid="uid://ca217djxdbh7o" path="res://Scripts/Abilities/EnemyAbilities/EnemyMeleeAttackAbility.cs" id="3_gtt4e"]
[ext_resource type="Script" uid="uid://cbt2jpgnl5vyn" path="res://Scripts/Enemies/StateMachine/EnemyAttackState.cs" id="4_dqpjx"]
[ext_resource type="Script" uid="uid://cr0yy0j57hduw" path="res://Scripts/Enemies/StateMachine/EnemyChaseState.cs" id="4_is1iy"]
[ext_resource type="Script" uid="uid://cdbdrba7wsge7" path="res://Scripts/Enemies/StateMachine/EnemyDeathState.cs" id="5_l7lc1"]
[ext_resource type="PackedScene" uid="uid://iifdnv8gbmhw" path="res://GameObjects/HealthComponent.tscn" id="5_r4olu"]
[ext_resource type="Script" uid="uid://ci6f0cxl5j6n3" path="res://Scripts/Enemies/StateMachine/EnemyPatrolState.cs" id="7_is1iy"]
[ext_resource type="Script" uid="uid://bk0sli8sgv4ix" path="res://Scripts/Enemies/StateMachine/EnemyWanderState.cs" id="8_h2jgk"]
[ext_resource type="Script" uid="uid://bvh1270fg0moq" path="res://Scripts/Enemies/StateMachine/EnemySuspicionState.cs" id="9_h2jgk"]
[ext_resource type="Script" uid="uid://dg50c86hmopvc" path="res://Scripts/DamageSystem/Damager.cs" id="11_0ae5k"]

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_pqwom"]
radius = 0.357833

[sub_resource type="SphereShape3D" id="SphereShape3D_0ae5k"]
radius = 1.5

[sub_resource type="SphereShape3D" id="SphereShape3D_epsjv"]
radius = 5.0

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_ixyjj"]
radius = 0.25

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_8pn51"]
animation = &"TEMP_EnemyAnimLibrary/human_attack_sword"

[sub_resource type="AnimationNodeOneShot" id="AnimationNodeOneShot_h32hr"]
fadein_time = 0.1
fadeout_time = 0.1

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_5yyp0"]
animation = &"TEMP_EnemyAnimLibrary/human_death"

[sub_resource type="AnimationNodeTransition" id="AnimationNodeTransition_nw3li"]
xfade_time = 0.2
input_0/name = "NotDeath"
input_0/auto_advance = false
input_0/break_loop_at_end = false
input_0/reset = true
input_1/name = "Death"
input_1/auto_advance = false
input_1/break_loop_at_end = false
input_1/reset = true

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_eo4mq"]
animation = &"TEMP_EnemyAnimLibrary/human_idle"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_15lv4"]
animation = &"TEMP_EnemyAnimLibrary/human_run"

[sub_resource type="AnimationNodeBlendSpace1D" id="AnimationNodeBlendSpace1D_76jb3"]
blend_point_0/node = SubResource("AnimationNodeAnimation_eo4mq")
blend_point_0/pos = 0.0
blend_point_1/node = SubResource("AnimationNodeAnimation_15lv4")
blend_point_1/pos = 1.0
min_space = 0.0

[sub_resource type="AnimationNodeBlendTree" id="AnimationNodeBlendTree_jv3td"]
graph_offset = Vector2(178.124, 49.2645)
nodes/Attack1/node = SubResource("AnimationNodeAnimation_8pn51")
nodes/Attack1/position = Vector2(280, 320)
nodes/AttackTrigger/node = SubResource("AnimationNodeOneShot_h32hr")
nodes/AttackTrigger/position = Vector2(720, 180)
nodes/Death/node = SubResource("AnimationNodeAnimation_5yyp0")
nodes/Death/position = Vector2(500, 540)
nodes/DeathTransition/node = SubResource("AnimationNodeTransition_nw3li")
nodes/DeathTransition/position = Vector2(980, 300)
nodes/MoveSpace/node = SubResource("AnimationNodeBlendSpace1D_76jb3")
nodes/MoveSpace/position = Vector2(500, 120)
nodes/output/position = Vector2(1240, 320)
node_connections = [&"AttackTrigger", 0, &"MoveSpace", &"AttackTrigger", 1, &"Attack1", &"DeathTransition", 0, &"AttackTrigger", &"DeathTransition", 1, &"Death", &"output", 0, &"DeathTransition"]

[node name="Enemy" type="CharacterBody3D" node_paths=PackedStringArray("StateMachine", "HealthComponent")]
collision_layer = 8
script = ExtResource("1_eyhau")
StateMachine = NodePath("StateMachine")
HealthComponent = NodePath("HealthComponent")

[node name="Abilities" type="Node3D" parent="."]

[node name="MeleeAttack" parent="Abilities" instance=ExtResource("2_uivum")]
script = ExtResource("3_gtt4e")
abilityDuration = 2.0
cooldownTimer = 5.0

[node name="StateMachine" type="Node" parent="." node_paths=PackedStringArray("initialState")]
script = ExtResource("1_3u8xu")
BaseMoveSpeed = 1.5
ChaseMoveSpeed = 2.0
initialState = NodePath("IdleState")

[node name="IdleState" type="Node" parent="StateMachine"]
script = ExtResource("3_epsjv")

[node name="ChaseState" type="Node" parent="StateMachine"]
script = ExtResource("4_is1iy")

[node name="AttackState" type="Node" parent="StateMachine"]
script = ExtResource("4_dqpjx")

[node name="DeathState" type="Node" parent="StateMachine"]
script = ExtResource("5_l7lc1")

[node name="PatrolState" type="Node" parent="StateMachine"]
script = ExtResource("7_is1iy")

[node name="WanderState" type="Node" parent="StateMachine"]
script = ExtResource("8_h2jgk")

[node name="SuspicionState" type="Node" parent="StateMachine"]
script = ExtResource("9_h2jgk")

[node name="HealthComponent" parent="." instance=ExtResource("5_r4olu")]
MaxHealth = 7.0
InvulnerabilityTime = 2.0

[node name="NavigationAgent3D" type="NavigationAgent3D" parent="."]
simplify_path = true
avoidance_enabled = true
height = 2.0
max_speed = 5.0
debug_enabled = true

[node name="CollisionShape3D" type="CollisionShape3D" parent="."]
shape = SubResource("CapsuleShape3D_pqwom")

[node name="RigPivot" type="Node3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -1, 0)

[node name="Rig" parent="RigPivot" instance=ExtResource("2_w1h0a")]

[node name="GeneralSkeleton" parent="RigPivot/Rig" index="0"]
bones/0/position = Vector3(-0.0525448, -0.0201936, 0.100136)
bones/0/rotation = Quaternion(-0.0365363, -0.0760241, -0.022294, 0.996187)
bones/2/rotation = Quaternion(-0.00852451, -0.00474547, 0.0303304, 0.999492)
bones/3/rotation = Quaternion(-0.00103488, -0.0079423, 0.0371207, 0.999279)
bones/4/rotation = Quaternion(-0.000836357, -0.00739458, 0.0372477, 0.999278)
bones/5/rotation = Quaternion(0.0222298, 0.00302193, -0.0304758, 0.999284)
bones/6/rotation = Quaternion(0.0222296, 0.00302195, -0.0304759, 0.999284)
bones/9/rotation = Quaternion(0.000599088, 0.0468032, -0.0520199, 0.997549)
bones/10/rotation = Quaternion(0.642199, 0.0576571, 0.746343, -0.165008)
bones/11/rotation = Quaternion(0.070994, 0.69562, -0.131332, 0.702726)
bones/12/rotation = Quaternion(0.188534, 0.686343, 0.128793, 0.690507)
bones/13/rotation = Quaternion(0.362052, 0.521091, -0.460872, -0.620467)
bones/14/rotation = Quaternion(-0.0733182, 0.186071, 0.0405881, 0.978956)
bones/16/rotation = Quaternion(0.0654328, -0.00433365, -0.217917, 0.973762)
bones/17/rotation = Quaternion(-0.336185, -0.621662, 0.407263, 0.578492)
bones/18/rotation = Quaternion(-0.00685528, 0.00554012, -0.142162, 0.989804)
bones/20/rotation = Quaternion(-0.10052, 0.680664, 0.167109, 0.706164)
bones/21/rotation = Quaternion(0.42953, 0.833552, 0.306887, -0.162835)
bones/22/rotation = Quaternion(-0.0179231, 0.00640528, -0.195053, 0.980608)
bones/25/rotation = Quaternion(0.00453323, -0.0109845, 0.0892075, 0.995942)
bones/26/rotation = Quaternion(0.621987, -0.143893, -0.715392, -0.283975)
bones/27/rotation = Quaternion(0.0485772, -0.699452, 0.109228, 0.704611)
bones/28/rotation = Quaternion(0.118531, -0.648957, -0.0989543, 0.744992)
bones/29/rotation = Quaternion(-0.575916, 0.445841, 0.573557, -0.374939)
bones/30/rotation = Quaternion(0.0354457, 0.188737, 0.0483735, 0.980195)
bones/32/rotation = Quaternion(0.0830823, 0.00552185, 0.224291, 0.970959)
bones/33/rotation = Quaternion(-0.530841, 0.466447, 0.585064, -0.397912)
bones/34/rotation = Quaternion(-0.00689461, 0.00375441, -0.093772, 0.995563)
bones/36/rotation = Quaternion(-0.102724, -0.68205, -0.164863, 0.705037)
bones/37/rotation = Quaternion(0.172631, 0.301298, -0.818963, 0.456856)
bones/38/rotation = Quaternion(-0.0182202, -0.000949105, 0.0280022, 0.999441)
bones/43/rotation = Quaternion(-0.0876298, -0.0103911, 0.995002, -0.0467386)
bones/44/rotation = Quaternion(-0.00584371, 0.983547, -0.177641, -0.0323177)
bones/45/rotation = Quaternion(-0.0243886, 0.589751, -0.806812, 0.0255652)
bones/46/rotation = Quaternion(0.00084205, -1.07652e-07, -2.55166e-07, 1)
bones/48/rotation = Quaternion(0.144493, 0.133574, 0.975409, -0.0992857)
bones/49/rotation = Quaternion(-0.0268563, 0.990404, -0.13485, -0.0139258)
bones/50/rotation = Quaternion(-0.0502204, 0.724973, -0.684511, 0.0577627)
bones/51/rotation = Quaternion(-0.0205665, 5.4293e-08, -1.01576e-07, 0.999789)
bones/55/rotation = Quaternion(0.227152, 0.131925, -0.615502, 0.743071)

[node name="Item_WarriorSholderArmor" parent="RigPivot/Rig/GeneralSkeleton" index="0"]
transform = Transform3D(0.377863, 0.902629, -0.206105, -0.925836, 0.370026, -0.0768673, 0.00688149, 0.219865, 0.975506, 0.221536, 1.35062, -0.0392454)
visible = false
bone_idx = 24

[node name="Item_WarriorSholderArmor1" parent="RigPivot/Rig/GeneralSkeleton" index="1"]
transform = Transform3D(0.713012, 0.333185, 0.616929, 0.354958, -0.930324, 0.0922002, 0.604664, 0.153244, -0.781599, 0.419461, 0.0767423, 0.19074)
visible = false
bone_idx = 40

[node name="Item_Sword" parent="RigPivot/Rig/GeneralSkeleton" index="2"]
transform = Transform3D(0.970014, -0.152536, -0.189224, 0.172524, 0.980509, 0.0940024, 0.171197, -0.123829, 0.977424, 0.0209667, 1.25078, -0.154645)
visible = false
bone_idx = 41

[node name="Item_SwordHolder" parent="RigPivot/Rig/GeneralSkeleton" index="3"]
transform = Transform3D(0.970014, -0.152536, -0.189224, 0.172524, 0.980509, 0.0940024, 0.171197, -0.123829, 0.977424, 0.184155, 7.16448e-05, 0.160897)
visible = false
bone_idx = 42

[node name="Item_WaterCanteen" parent="RigPivot/Rig/GeneralSkeleton" index="4"]
transform = Transform3D(0.987447, 0.0499732, -0.149839, -0.0388626, 0.996336, 0.0761837, 0.153097, -0.0694042, 0.985771, -0.205518, 0.910523, 0.00920686)
visible = false
bone_idx = 53

[node name="Item_WaterBladder_01" parent="RigPivot/Rig/GeneralSkeleton" index="5"]
transform = Transform3D(0.987447, 0.0499732, -0.149839, -0.0388626, 0.996336, 0.0761837, 0.153097, -0.0694042, 0.985771, 0.189077, 0.744503, 0.0603574)
visible = false
bone_idx = 54

[node name="SM_Prop_SpellBook_03" parent="RigPivot/Rig/GeneralSkeleton" index="6"]
transform = Transform3D(0.233461, 0.943126, -0.236663, -0.895962, 0.114077, -0.429231, -0.377821, 0.31225, 0.871637, 0.211526, 0.948051, 0.0435653)
visible = false
bone_idx = 55

[node name="Item_Pouch" parent="RigPivot/Rig/GeneralSkeleton" index="7"]
transform = Transform3D(1.04657, 0.0450707, -0.16123, -0.0411896, 1.05869, 0.0285806, 0.162265, -0.021956, 1.04715, -0.071201, -0.0884111, 0.0520767)
visible = false
bone_idx = 56

[node name="SM_Prop_Vials" parent="RigPivot/Rig/GeneralSkeleton" index="8"]
transform = Transform3D(-0.203788, 0.0499732, -0.977739, 0.0782012, 0.996336, 0.0346245, 0.975887, -0.0694043, -0.206949, -0.19775, 0.91412, 0.0146942)
visible = false
bone_idx = 57

[node name="Item_SwordSheath" parent="RigPivot/Rig/GeneralSkeleton" index="9"]
transform = Transform3D(0.401413, -0.268753, 0.875579, 0.477008, 0.877439, 0.0506374, -0.781877, 0.397332, 0.480413, 0.237031, 0.72583, 0.0204058)
visible = false
bone_idx = 58

[node name="Item_Dagger" parent="RigPivot/Rig/GeneralSkeleton" index="10"]
transform = Transform3D(0.987447, 0.0499732, -0.149839, -0.0388626, 0.996336, 0.0761837, 0.153097, -0.0694042, 0.985771, 0.200061, 0.852761, 0.076058)
visible = false
bone_idx = 59

[node name="Item_CoinBag" parent="RigPivot/Rig/GeneralSkeleton" index="11"]
transform = Transform3D(0.987447, 0.0499732, -0.149839, -0.0388626, 0.996336, 0.0761837, 0.153097, -0.0694042, 0.985771, -0.215201, 0.865407, 0.0164231)
visible = false
bone_idx = 60

[node name="Character_Female_Witch" parent="RigPivot/Rig/GeneralSkeleton" index="12"]
visible = false

[node name="Character_Female_Queen" parent="RigPivot/Rig/GeneralSkeleton" index="13"]
visible = false

[node name="Character_Female_Druid" parent="RigPivot/Rig/GeneralSkeleton" index="14"]
visible = false

[node name="Character_Female_Gypsy" parent="RigPivot/Rig/GeneralSkeleton" index="15"]
visible = false

[node name="Character_Female_Peasant_01" parent="RigPivot/Rig/GeneralSkeleton" index="16"]
visible = false

[node name="Character_Female_Peasant_02" parent="RigPivot/Rig/GeneralSkeleton" index="17"]
visible = false

[node name="Character_Male_Baird" parent="RigPivot/Rig/GeneralSkeleton" index="18"]
visible = false

[node name="Character_Male_Sorcerer" parent="RigPivot/Rig/GeneralSkeleton" index="19"]
visible = false

[node name="Character_Male_King" parent="RigPivot/Rig/GeneralSkeleton" index="20"]
visible = false

[node name="Character_Male_Rouge_01" parent="RigPivot/Rig/GeneralSkeleton" index="22"]
visible = false

[node name="Character_Male_Wizard" parent="RigPivot/Rig/GeneralSkeleton" index="23"]
visible = false

[node name="AnimationPlayer" parent="RigPivot/Rig" index="1"]
libraries = {
&"TEMP_EnemyAnimLibrary": ExtResource("2_bhjmh")
}

[node name="RightHandAttachment" type="BoneAttachment3D" parent="RigPivot"]
transform = Transform3D(-0.10809, -0.171457, 0.979244, 0.419701, -0.900801, -0.111395, 0.901204, 0.398949, 0.169328, -0.301956, 0.712316, -0.0911809)
bone_name = "RightHand"
bone_idx = 28
use_external_skeleton = true
external_skeleton = NodePath("../Rig/GeneralSkeleton")

[node name="WeaponSlot" type="Node3D" parent="RigPivot/RightHandAttachment"]
transform = Transform3D(0.998604, -0.0369963, -0.0377162, 0.0394601, 0.996984, 0.0668198, 0.0351305, -0.0682148, 0.997052, -0.00729713, 0.0490943, 0.0338885)

[node name="SM_Prop_SwordOrnate_01" parent="RigPivot/RightHandAttachment/WeaponSlot" instance=ExtResource("2_vq338")]
transform = Transform3D(0.523173, 0.85195, 0.0217142, -0.736141, 0.438924, 0.515211, 0.429403, -0.285529, 0.856789, -0.00156301, 0.00976056, -0.00743541)

[node name="AttackRange" type="ShapeCast3D" parent="RigPivot"]
shape = SubResource("SphereShape3D_0ae5k")
target_position = Vector3(0, 0, 0)
collision_mask = 4
debug_shape_custom_color = Color(1, 0, 0, 1)

[node name="ChaseRange" type="ShapeCast3D" parent="RigPivot"]
shape = SubResource("SphereShape3D_epsjv")
collision_mask = 4

[node name="MeleeAttack" type="BoneAttachment3D" parent="."]
transform = Transform3D(-0.10809, -0.171457, 0.979244, 0.419701, -0.900801, -0.111395, 0.901204, 0.398949, 0.169328, -0.301956, -0.287684, -0.0911809)
bone_name = "RightHand"
bone_idx = 28
use_external_skeleton = true
external_skeleton = NodePath("../RigPivot/Rig/GeneralSkeleton")

[node name="MeleeAttackCollider" type="ShapeCast3D" parent="MeleeAttack" node_paths=PackedStringArray("selfCollider")]
unique_name_in_owner = true
transform = Transform3D(0.533482, 0.845291, -0.0296918, -0.684584, 0.452139, 0.571765, 0.496732, -0.284699, 0.819881, -0.00893862, 0.058267, 0.0257543)
shape = SubResource("CapsuleShape3D_ixyjj")
target_position = Vector3(0, 1, 0)
margin = 0.5
collision_mask = 4
debug_shape_custom_color = Color(0.882353, 0, 0, 1)
script = ExtResource("11_0ae5k")
damage = 2.0
selfCollider = NodePath("../..")

[node name="AnimationTree" type="AnimationTree" parent="."]
root_node = NodePath("../RigPivot/Rig")
tree_root = SubResource("AnimationNodeBlendTree_jv3td")
anim_player = NodePath("../AnimationPlayer")
parameters/AttackTrigger/active = false
parameters/AttackTrigger/internal_active = false
parameters/AttackTrigger/request = 0
parameters/DeathTransition/current_state = "NotDeath"
parameters/DeathTransition/transition_request = ""
parameters/DeathTransition/current_index = 0
parameters/MoveSpace/blend_position = 0.0

[node name="AnimationPlayer" type="AnimationPlayer" parent="."]
root_node = NodePath("../RigPivot/Rig")
libraries = {
&"TEMP_EnemyAnimLibrary": ExtResource("2_bhjmh")
}

[connection signal="OnAttackTriggered" from="StateMachine" to="Abilities/MeleeAttack" method="StartAbility"]
[connection signal="OnDeathTriggered" from="HealthComponent" to="StateMachine" method="ChangeToDeathState"]
[connection signal="velocity_computed" from="NavigationAgent3D" to="StateMachine" method="OnNavAgentVelocityComputed"]

[editable path="RigPivot/Rig"]
