[gd_scene load_steps=29 format=3 uid="uid://cy5lmq1djweto"]

[ext_resource type="Script" uid="uid://2ctr74rdos6v" path="res://Scripts/Statemachines/Enemies/EnemyStateMachine.cs" id="1_3u8xu"]
[ext_resource type="Script" uid="uid://b0k1rr2yuf22n" path="res://Scripts/Core/EnemyEntityAccessor.cs" id="1_eyhau"]
[ext_resource type="AnimationLibrary" uid="uid://beh47qlnu58iu" path="res://Animations/Humanoid/TEMP_EnemyAnimLibrary.res" id="2_bhjmh"]
[ext_resource type="PackedScene" uid="uid://bm4xy5gup2qvo" path="res://GameObjects/AbilityNodes/CombatAbility.tscn" id="2_uivum"]
[ext_resource type="PackedScene" uid="uid://bbf6ttwtueode" path="res://Art/_Enemies_TEMP/SM_Prop_SwordOrnate_01.fbx" id="2_vq338"]
[ext_resource type="Script" uid="uid://ct0h6lq4lcxnx" path="res://Scripts/Statemachines/Enemies/States/EnemyIdleState.cs" id="3_epsjv"]
[ext_resource type="Script" uid="uid://cbt2jpgnl5vyn" path="res://Scripts/Statemachines/Enemies/States/EnemyAttackState.cs" id="4_dqpjx"]
[ext_resource type="Script" uid="uid://cr0yy0j57hduw" path="res://Scripts/Statemachines/Enemies/States/EnemyChaseState.cs" id="4_is1iy"]
[ext_resource type="Script" uid="uid://cdbdrba7wsge7" path="res://Scripts/Statemachines/Enemies/States/EnemyDeathState.cs" id="5_l7lc1"]
[ext_resource type="PackedScene" uid="uid://iifdnv8gbmhw" path="res://GameObjects/CombatComponents/HealthComponent.tscn" id="5_r4olu"]
[ext_resource type="Script" uid="uid://ci6f0cxl5j6n3" path="res://Scripts/Statemachines/Enemies/States/EnemyPatrolState.cs" id="7_is1iy"]
[ext_resource type="Script" uid="uid://bk0sli8sgv4ix" path="res://Scripts/Statemachines/Enemies/States/EnemyWanderState.cs" id="8_h2jgk"]
[ext_resource type="Script" uid="uid://bvh1270fg0moq" path="res://Scripts/Statemachines/Enemies/States/EnemySuspicionState.cs" id="9_h2jgk"]
[ext_resource type="PackedScene" uid="uid://gpcubqmedifm" path="res://Art/NPCRig.fbx" id="12_anek8"]
[ext_resource type="Material" uid="uid://btjrtdpje2iqw" path="res://Art/NPCs/NPCMat.tres" id="13_whi2b"]
[ext_resource type="PackedScene" uid="uid://cqm2hv33616h0" path="res://GameObjects/CombatComponents/Damager.tscn" id="15_uivum"]

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_pqwom"]
radius = 0.357833

[sub_resource type="SphereShape3D" id="SphereShape3D_0ae5k"]
radius = 1.5

[sub_resource type="SphereShape3D" id="SphereShape3D_epsjv"]
radius = 5.0

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_gtt4e"]
radius = 0.4

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_8pn51"]
animation = &"TEMP_EnemyAnimLibrary/human_attack_sword"

[sub_resource type="AnimationNodeOneShot" id="AnimationNodeOneShot_h32hr"]
fadein_time = 0.1
fadeout_time = 0.1

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_5yyp0"]
animation = &"TEMP_EnemyAnimLibrary/human_death"

[sub_resource type="AnimationNodeTransition" id="AnimationNodeTransition_nw3li"]
xfade_time = 0.2
input_0/name = "NotDeath"
input_0/auto_advance = false
input_0/break_loop_at_end = false
input_0/reset = true
input_1/name = "Death"
input_1/auto_advance = false
input_1/break_loop_at_end = false
input_1/reset = true

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_eo4mq"]
animation = &"TEMP_EnemyAnimLibrary/human_idle"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_15lv4"]
animation = &"TEMP_EnemyAnimLibrary/human_run"

[sub_resource type="AnimationNodeBlendSpace1D" id="AnimationNodeBlendSpace1D_76jb3"]
blend_point_0/node = SubResource("AnimationNodeAnimation_eo4mq")
blend_point_0/pos = 0.0
blend_point_1/node = SubResource("AnimationNodeAnimation_15lv4")
blend_point_1/pos = 1.0
min_space = 0.0

[sub_resource type="AnimationNodeBlendTree" id="AnimationNodeBlendTree_jv3td"]
nodes/Attack1/node = SubResource("AnimationNodeAnimation_8pn51")
nodes/Attack1/position = Vector2(280, 320)
nodes/AttackTrigger/node = SubResource("AnimationNodeOneShot_h32hr")
nodes/AttackTrigger/position = Vector2(720, 180)
nodes/Death/node = SubResource("AnimationNodeAnimation_5yyp0")
nodes/Death/position = Vector2(500, 540)
nodes/DeathTransition/node = SubResource("AnimationNodeTransition_nw3li")
nodes/DeathTransition/position = Vector2(980, 300)
nodes/MoveSpace/node = SubResource("AnimationNodeBlendSpace1D_76jb3")
nodes/MoveSpace/position = Vector2(500, 120)
nodes/output/position = Vector2(1240, 320)
node_connections = [&"AttackTrigger", 0, &"MoveSpace", &"AttackTrigger", 1, &"Attack1", &"DeathTransition", 0, &"AttackTrigger", &"DeathTransition", 1, &"Death", &"output", 0, &"DeathTransition"]

[node name="Enemy" type="CharacterBody3D" node_paths=PackedStringArray("StateMachine", "HealthComponent")]
collision_layer = 9
script = ExtResource("1_eyhau")
StateMachine = NodePath("StateMachine")
HealthComponent = NodePath("HealthComponent")

[node name="Abilities" type="Node3D" parent="."]

[node name="MeleeAttack" parent="Abilities" node_paths=PackedStringArray("abilityDamager") instance=ExtResource("2_uivum")]
damageAmount = 5
abilityDamager = NodePath("../../MeleeAttack/Damager")
abilityDuration = 2.0
abilityCooldownTime = 3.0

[node name="StateMachine" type="Node" parent="." node_paths=PackedStringArray("MeleeAttackAbility", "initialState")]
script = ExtResource("1_3u8xu")
BaseMoveSpeed = 1.5
ChaseMoveSpeed = 2.0
MeleeAttackAbility = NodePath("../Abilities/MeleeAttack")
initialState = NodePath("IdleState")

[node name="IdleState" type="Node" parent="StateMachine"]
script = ExtResource("3_epsjv")

[node name="ChaseState" type="Node" parent="StateMachine"]
script = ExtResource("4_is1iy")

[node name="AttackState" type="Node" parent="StateMachine"]
script = ExtResource("4_dqpjx")

[node name="DeathState" type="Node" parent="StateMachine"]
script = ExtResource("5_l7lc1")

[node name="PatrolState" type="Node" parent="StateMachine"]
script = ExtResource("7_is1iy")

[node name="WanderState" type="Node" parent="StateMachine"]
script = ExtResource("8_h2jgk")

[node name="SuspicionState" type="Node" parent="StateMachine"]
script = ExtResource("9_h2jgk")

[node name="HealthComponent" parent="." instance=ExtResource("5_r4olu")]
MaxHealth = 7.0
InvulnerabilityTime = 2.0

[node name="NavigationAgent3D" type="NavigationAgent3D" parent="."]
simplify_path = true
avoidance_enabled = true
height = 2.0
max_speed = 5.0
debug_enabled = true

[node name="CollisionShape3D" type="CollisionShape3D" parent="."]
shape = SubResource("CapsuleShape3D_pqwom")

[node name="RigPivot" type="Node3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -1, 0)

[node name="Rig" parent="RigPivot"]
_import_path = NodePath("")
unique_name_in_owner = false
process_mode = 0
process_priority = 0
process_physics_priority = 0
process_thread_group = 0
physics_interpolation_mode = 0
auto_translate_mode = 0
editor_description = ""
script = null

[node name="NPCRig" parent="RigPivot" instance=ExtResource("12_anek8")]

[node name="GeneralSkeleton" parent="RigPivot/NPCRig" index="0"]
bones/3/rotation = Quaternion(-1.49012e-08, -1.49012e-08, -1.49012e-08, 1)
bones/4/rotation = Quaternion(8.9407e-08, 0, 0, 1)
bones/9/rotation = Quaternion(5.96046e-08, 1.49012e-08, 2.98023e-08, 1)
bones/11/rotation = Quaternion(0, 0.707107, 2.10734e-08, 0.707107)
bones/12/rotation = Quaternion(1.65138e-09, 0.707107, 1.65138e-09, 0.707107)
bones/16/rotation = Quaternion(0, -2.98023e-08, 5.96047e-08, 1)
bones/17/rotation = Quaternion(-0.415217, -0.572359, 0.47558, 0.523281)
bones/18/rotation = Quaternion(-0.00691221, 0.0257175, -0.0570025, 0.998019)
bones/20/rotation = Quaternion(-0.214187, 0.673887, 0.214187, 0.673887)
bones/21/rotation = Quaternion(0.614485, 0.718439, 0.247717, -0.211873)
bones/25/rotation = Quaternion(2.98023e-08, 0, -1.49012e-08, 1)
bones/28/rotation = Quaternion(3.50095e-09, -0.707107, -3.50095e-09, 0.707107)
bones/29/rotation = Quaternion(-0.396606, 0.585409, 0.647968, -0.283086)
bones/32/rotation = Quaternion(2.98023e-08, 2.98023e-08, 0, 1)
bones/33/rotation = Quaternion(-0.523281, 0.475581, 0.572359, -0.415217)
bones/36/rotation = Quaternion(-0.214187, -0.673887, -0.214187, 0.673887)
bones/37/rotation = Quaternion(0.211873, 0.247717, -0.718439, 0.614485)
bones/43/rotation = Quaternion(-1.49012e-08, 4.47035e-08, 1, 4.47035e-08)
bones/44/rotation = Quaternion(5.96047e-08, 1, -2.05877e-08, -7.2066e-08)
bones/45/rotation = Quaternion(3.16101e-08, 0.707107, -0.707107, 1.05367e-08)
bones/48/rotation = Quaternion(2.98023e-08, 1.49012e-08, 1, -1.49012e-08)
bones/49/rotation = Quaternion(-2.98023e-08, 1, -5.1831e-09, 5.77857e-08)
bones/50/rotation = Quaternion(-1.05367e-07, 0.707107, -0.707107, 2.10734e-08)
bones/55/rotation = Quaternion(0.227152, 0.131925, -0.615502, 0.743071)

[node name="Item_WarriorSholderArmor" parent="RigPivot/NPCRig/GeneralSkeleton" index="0"]
transform = Transform3D(1, -2.98023e-08, 1.49012e-07, 5.96047e-08, 1, -2.68221e-07, -1.19209e-07, 2.98023e-07, 1, 0.238346, 1.43201, -0.0614178)
visible = false
bone_idx = 24

[node name="Item_WarriorSholderArmor1" parent="RigPivot/NPCRig/GeneralSkeleton" index="1"]
transform = Transform3D(0.882852, 0.0114634, 0.469511, 0.0129832, -0.999915, 2.92414e-07, 0.469471, 0.0060955, -0.882927, -7.45058e-08, 1.19209e-07, -4.9267e-07)
visible = false
bone_idx = 40

[node name="Item_Sword" parent="RigPivot/NPCRig/GeneralSkeleton" index="2"]
transform = Transform3D(1, 3.20662e-08, -5.95185e-08, -3.20662e-08, 1, -2.16067e-07, 5.95185e-08, 2.16067e-07, 1, 0.00346233, 1.2903, -0.15997)
visible = false
bone_idx = 41

[node name="Item_SwordHolder" parent="RigPivot/NPCRig/GeneralSkeleton" index="3"]
transform = Transform3D(1, 3.20662e-08, -5.95185e-08, -3.20662e-08, 1, -2.16067e-07, 5.95185e-08, 2.16067e-07, 1, -3.47745e-08, 1.19209e-07, -2.27243e-07)
visible = false
bone_idx = 42

[node name="Item_WaterCanteen" parent="RigPivot/NPCRig/GeneralSkeleton" index="4"]
transform = Transform3D(1, 0, 0, 0, 1, 2.98023e-08, 0, -2.98023e-08, 1, -0.201144, 0.925973, 0.00419172)
visible = false
bone_idx = 53

[node name="Item_WaterBladder_01" parent="RigPivot/NPCRig/GeneralSkeleton" index="5"]
transform = Transform3D(1, 0, 0, 0, 1, 2.98023e-08, 0, -2.98023e-08, 1, 0.202781, 0.776731, -0.0171594)
visible = false
bone_idx = 54

[node name="SM_Prop_SpellBook_03" parent="RigPivot/NPCRig/GeneralSkeleton" index="6"]
transform = Transform3D(0.207507, 0.974658, -0.0835657, -0.85479, 0.139119, -0.499981, -0.475685, 0.17518, 0.861995, 0.214467, 0.981819, -0.0215694)
visible = false
bone_idx = 55

[node name="Item_Pouch" parent="RigPivot/NPCRig/GeneralSkeleton" index="7"]
transform = Transform3D(1.05988, 0, 0, 0, 1.05859, -0.0522581, 0, 0.0522581, 1.05859, -0.0231286, -0.0655643, -0.0497769)
visible = false
bone_idx = 56

[node name="SM_Prop_Vials" parent="RigPivot/NPCRig/GeneralSkeleton" index="8"]
transform = Transform3D(-0.0548626, 5.12956e-09, -0.998494, 8.9407e-08, 1, 2.24802e-10, 0.998494, -8.926e-08, -0.0548626, -0.192773, 0.929564, 0.00871108)
visible = false
bone_idx = 57

[node name="Item_SwordSheath" parent="RigPivot/NPCRig/GeneralSkeleton" index="9"]
transform = Transform3D(0.258133, -0.238648, 0.93617, 0.549586, 0.833217, 0.0608647, -0.794558, 0.498795, 0.346239, 0.244742, 0.763295, -0.0651505)
visible = false
bone_idx = 58

[node name="Item_Dagger" parent="RigPivot/NPCRig/GeneralSkeleton" index="10"]
transform = Transform3D(1, 0, 0, 0, 1, 2.98023e-08, 0, -2.98023e-08, 1, 0.211824, 0.884051, 0.0049194)
visible = false
bone_idx = 59

[node name="Item_CoinBag" parent="RigPivot/NPCRig/GeneralSkeleton" index="11"]
transform = Transform3D(1, 0, 0, 0, 1, 2.98023e-08, 0, -2.98023e-08, 1, -0.207847, 0.880038, 0.00931905)
visible = false
bone_idx = 60

[node name="Character_Female_Witch" parent="RigPivot/NPCRig/GeneralSkeleton" index="12"]
visible = false

[node name="Character_Female_Queen" parent="RigPivot/NPCRig/GeneralSkeleton" index="13"]
visible = false

[node name="Character_Female_Druid" parent="RigPivot/NPCRig/GeneralSkeleton" index="14"]
visible = false

[node name="Character_Female_Gypsy" parent="RigPivot/NPCRig/GeneralSkeleton" index="15"]
visible = false

[node name="Character_Female_Peasant_01" parent="RigPivot/NPCRig/GeneralSkeleton" index="16"]
visible = false

[node name="Character_Female_Peasant_02" parent="RigPivot/NPCRig/GeneralSkeleton" index="17"]
visible = false

[node name="Character_Male_Baird" parent="RigPivot/NPCRig/GeneralSkeleton" index="18"]
visible = false

[node name="Character_Male_Sorcerer" parent="RigPivot/NPCRig/GeneralSkeleton" index="19"]
visible = false

[node name="Character_Male_King" parent="RigPivot/NPCRig/GeneralSkeleton" index="20"]
visible = false

[node name="Character_Male_Peasant_01" parent="RigPivot/NPCRig/GeneralSkeleton" index="21"]
surface_material_override/0 = ExtResource("13_whi2b")

[node name="Character_Male_Rouge_01" parent="RigPivot/NPCRig/GeneralSkeleton" index="22"]
visible = false

[node name="Character_Male_Wizard" parent="RigPivot/NPCRig/GeneralSkeleton" index="23"]
visible = false

[node name="AnimationPlayer" parent="RigPivot/NPCRig" index="1"]
libraries = {
&"": ExtResource("2_bhjmh")
}

[node name="RightHandAttachment" type="BoneAttachment3D" parent="RigPivot"]
transform = Transform3D(-0.0374326, -0.0729582, 0.996632, 0.384566, -0.921574, -0.0530195, 0.922338, 0.381287, 0.0625542, -0.264307, 0.677373, -0.108607)
bone_name = "RightHand"
use_external_skeleton = true
external_skeleton = NodePath("../Rig/GeneralSkeleton")

[node name="WeaponSlot" type="Node3D" parent="RigPivot/RightHandAttachment"]
transform = Transform3D(0.998604, -0.0369963, -0.0377162, 0.0394601, 0.996984, 0.0668198, 0.0351305, -0.0682148, 0.997052, -0.00729713, 0.0490943, 0.0338885)

[node name="SM_Prop_SwordOrnate_01" parent="RigPivot/RightHandAttachment/WeaponSlot" instance=ExtResource("2_vq338")]
transform = Transform3D(0.523173, 0.85195, 0.0217142, -0.736141, 0.438924, 0.515211, 0.429403, -0.285529, 0.856789, -0.00156301, 0.00976056, -0.00743541)

[node name="AttackRange" type="ShapeCast3D" parent="RigPivot"]
shape = SubResource("SphereShape3D_0ae5k")
target_position = Vector3(0, 0, 0)
collision_mask = 4
debug_shape_custom_color = Color(1, 0, 0, 1)

[node name="ChaseRange" type="ShapeCast3D" parent="RigPivot"]
shape = SubResource("SphereShape3D_epsjv")
collision_mask = 4

[node name="MeleeAttack" type="BoneAttachment3D" parent="."]
transform = Transform3D(-0.0374326, -0.0729582, 0.996632, 0.384566, -0.921574, -0.0530195, 0.922338, 0.381287, 0.0625542, -0.264307, -0.322627, -0.108607)
bone_name = "RightHand"
use_external_skeleton = true
external_skeleton = NodePath("../RigPivot/Rig/GeneralSkeleton")

[node name="Damager" parent="MeleeAttack" node_paths=PackedStringArray("selfCollider") instance=ExtResource("15_uivum")]
transform = Transform3D(0.571545, 0.778873, 0.258251, -0.820571, 0.542501, 0.179877, -1.49012e-08, -0.314721, 0.949184, 0.758676, 0.534602, -0.269668)
collision_layer = 5
selfCollider = NodePath("../..")

[node name="CollisionShape3D" parent="MeleeAttack/Damager" index="0"]
transform = Transform3D(0.988959, 0.148189, 0, -0.148189, 0.988959, 0, 0, 0, 1, 0.107063, 0.126615, 3.49246e-09)
shape = SubResource("CapsuleShape3D_gtt4e")

[node name="AnimationTree" type="AnimationTree" parent="."]
root_node = NodePath("../RigPivot/Rig")
tree_root = SubResource("AnimationNodeBlendTree_jv3td")
anim_player = NodePath("../AnimationPlayer")
parameters/AttackTrigger/active = false
parameters/AttackTrigger/internal_active = false
parameters/AttackTrigger/request = 0
parameters/DeathTransition/current_state = "NotDeath"
parameters/DeathTransition/transition_request = ""
parameters/DeathTransition/current_index = 0
parameters/MoveSpace/blend_position = 0.0

[node name="AnimationPlayer" type="AnimationPlayer" parent="."]
root_node = NodePath("../RigPivot/Rig")
libraries = {
&"TEMP_EnemyAnimLibrary": ExtResource("2_bhjmh")
}

[connection signal="OnDeathTriggered" from="HealthComponent" to="StateMachine" method="ChangeToDeathState"]
[connection signal="velocity_computed" from="NavigationAgent3D" to="StateMachine" method="OnNavAgentVelocityComputed"]

[editable path="RigPivot/NPCRig"]
[editable path="MeleeAttack/Damager"]
